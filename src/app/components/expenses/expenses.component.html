<div class="grid">
  <div class="col-12">
    <h2>{{ title }}</h2>

    <ng-template *ngTemplateOutlet="description"></ng-template>
  </div>
</div>

<div class="grid">
  <div class="col-12">
    <p-table
      dataKey="id"
      editMode="row"
      [value]="expenses"
      [editingRowKeys]="editingRowKeys"
      [styleClass]="'p-datatable-sm'"
    >
      <ng-template
        pTemplate="body"
        let-expense
        let-editing="editing"
        let-rowIndex="rowIndex"
      >
        <tr [pEditableRow]="expense">
          <!-- EXPENSE TITLE -->
          <td [width]="'40%'">
            <p-cellEditor>
              <ng-template pTemplate="input">
                <input
                  pInputText
                  type="text"
                  class="p-inputtext-sm"
                  placeholder="Expense Title"
                  [(ngModel)]="expense.title"
                  [style]="{ width: '100%' }"
                />
              </ng-template>
              <ng-template pTemplate="output">
                {{ expense.title }}
              </ng-template>
            </p-cellEditor>
          </td>

          <!-- EXPENSE CATEGORY -->
          <td [width]="'25%'">
            <p-cellEditor>
              <ng-template pTemplate="input">
                <p-dropdown
                  [options]="expenseCategories"
                  optionLabel="title"
                  appendTo="body"
                  class="p-inputtext-sm"
                  [(ngModel)]="expense.category"
                  [style]="{ width: '100%' }"
                ></p-dropdown>
              </ng-template>
              <ng-template pTemplate="output">
                {{ expense.category.title }}
              </ng-template>
            </p-cellEditor>
          </td>

          <!-- EXPENSE AMOUNT -->
          <td [width]="'20%'">
            <p-cellEditor>
              <ng-template pTemplate="input">
                <p-inputNumber
                  mode="currency"
                  currency="EUR"
                  class="p-inputtext-sm"
                  inputStyleClass="w-full"
                  name="amount"
                  [minFractionDigits]="0"
                  [maxFractionDigits]="2"
                  [(ngModel)]="expense.amount"
                />
              </ng-template>
              <ng-template pTemplate="output">
                {{ expense.amount | currency : "EUR" : "symbol" : "2.0" }}
              </ng-template>
            </p-cellEditor>
          </td>

          <!-- EDIT/SAVE/CANCEL/DELETE BUTTONS -->
          <td [width]="'15%'" style="text-align: right">
            <div class="flex align-items-center justify-content-center gap-2">
              <!-- EDIT -->
              <button
                *ngIf="!editing"
                pButton
                pRipple
                type="button"
                pInitEditableRow
                pTooltip="Edit Expense"
                tooltipPosition="top"
                icon="pi pi-pencil"
                class="p-button-rounded p-button-text p-button-sm"
                (click)="onRowEditInit(expense)"
              ></button>

              <!-- SAVE -->
              <button
                *ngIf="editing"
                pButton
                pRipple
                type="button"
                pSaveEditableRow
                pTooltip="Save"
                tooltipPosition="top"
                icon="pi pi-check"
                class="p-button-rounded p-button-text p-button-success p-button-sm"
                (click)="onRowEditSave(expense)"
              ></button>

              <!-- CANCEL -->
              <button
                *ngIf="editing"
                pButton
                pRipple
                type="button"
                pCancelEditableRow
                pTooltip="Cancel"
                tooltipPosition="top"
                icon="pi pi-times"
                class="p-button-rounded p-button-text p-button-warning p-button-sm"
                (click)="onRowEditCancel(expense, rowIndex)"
              ></button>

              <!-- DELETE -->
              <button
                pButton
                pRipple
                pTooltip="Delete Expense"
                tooltipPosition="top"
                type="button"
                icon="pi pi-trash"
                class="p-button-rounded p-button-text p-button-danger ml-2 p-button-sm"
                (click)="deleteExpense(rowIndex)"
              ></button>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>

<div class="grid">
  <div class="col-12">
    <p-button label="Add Expense" (onClick)="addExpense()"></p-button>
  </div>
</div>
